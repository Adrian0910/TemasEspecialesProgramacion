class Chat extends StatelessWidget{

final txtMensaje = TextEditingController();
String sms;

  @override
  Widget build(BuildContext context) {
    // TODO: implement build
    return Scaffold(
      appBar: AppBar(
        title: Text('Todos'),
        backgroundColor: Color.fromARGB(255, 7, 94, 84),
        actions: <Widget>[
          IconButton(
            icon: Icon(Icons.videocam),
            onPressed: (){
              print('Hacer Videollamada');
            },
          ),
          IconButton(
            icon: Icon(Icons.phone),
                onPressed: (){
                  print('Quieres Buscar Algo?');
                },
                   ),
              IconButton(
                icon: Icon(Icons.more_vert),
                onPressed: (){
                  print('Este es el Menu');
                },
              )  
        ],
      ),

      body:

      StreamBuilder(
        stream: Firestore.instance.collection('whats').snapshots(),
        builder: (context, snap){
          return Column(
        crossAxisAlignment: CrossAxisAlignment.end,
        children: <Widget>[
          Flexible(
            child: 
            ListView.builder(
              padding: EdgeInsets.all(20),
              reverse: false,
              itemBuilder: (context ,index){
               return consulta(index,snap.data.documents[index]);
              },
              itemCount: snap.data.documents.length,
            ),
          ),
          Row(
            children: <Widget>[
              Expanded(
                child:
                TextField(
                      decoration: InputDecoration(
                      labelText: 'Escribe un mensaje',
                      hintText: 'Escribe un mensaje',
                      border: OutlineInputBorder(
                      borderRadius: BorderRadius.circular(50)
                    )
                  ),
                      controller:  txtMensaje,
                ),
              ),
              Expanded(
                child: 
                IconButton(
                  icon: Icon(Icons.send),
                  color: Colors.green,
                  onPressed: (){
                 insertar(txtMensaje.text);
                  },
                ),
              )
            ],
          )
        ],
      );
     },
    )
   );
  }
}

void insertar (String sms) async{
  await bd.collection("whats").add({'mensaje':sms});
}

Widget consulta (int index ,DocumentSnapshot cons){
return Container(
margin: const EdgeInsets.symmetric(vertical: 8.0),
child: Container(
width: 200.0,
child: Wrap(
   direction: Axis.horizontal,
  children: <Widget>[
   Row(
    
     children: <Widget>[
       Container(
decoration: BoxDecoration(
color: Colors.lightGreen,
borderRadius: BorderRadius.circular(10),
),
child: Column(
children: <Widget>[
Container(
margin: const EdgeInsets.only(
right: 12, left: 12, top: 7, bottom: 5.0),
child: Text(cons.data['mensaje'],
style: TextStyle(
fontSize: 20,
color: Colors.black
),
),
),
],
),
),
Container(
width: 35,
height: 35,
margin: EdgeInsets.only(left: 5),
decoration: BoxDecoration(
shape: BoxShape.circle,
image: DecorationImage(
image: AssetImage("images/1.png"),
fit: BoxFit.fill
)
),
),

     ],
   )
  ],)
),
);
}
